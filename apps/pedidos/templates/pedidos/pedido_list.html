{% extends 'base.html' %}
{%  load static %}

{% block main %}

    <p>
        <h1>Serviços contratados</h1>
        <a href="{% url 'create_pedido' %}" class="btn btn-info">Cadastrar nova venda</a>
    </p><br>


    <div class="row">
        {%  for pedido in object_list %}
        <div class="col-md-4">
            {% if pedido.status.nome == 'Novo' %}
                <div class="card text-white bg-info mb-3" >
            {% elif pedido.status.nome == 'Finalizado' %}
                <div class="card text-white bg-dark mb-3" >
            {% else %}
                <div class="card bg-light mb-3" >
            {% endif %}
                <div class="card-header"><h5>{{ pedido.cliente.nome }} <br> Pedido {{ pedido.id }}</h5></div>
                <div class="card-body">
                    <h5 class="card-title">Solicitado em {{ pedido.dataHoraCriacao|date:'d/m/Y' }}</h5>
                    <p class="card-text">
                        {{ pedido.cliente.nome }}<br>
                        {{ pedido.servico.nome }}<br>
                        Vendidor por:<br> {{ pedido.vendedor.nome }}<br>

                        Movimentações: {{ pedido.total_andamentos }}<br>
                        <b>{{ pedido.status }}</b>
                    </p>
                    <!-- Accordion -->
                    <div id="accordionParcela{{ pedido.id }}">
                      <div class="card">
                        <div class="card-header" id="headingOne">
                          <h5 class="mb-0">
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOne{{ pedido.id }}" aria-expanded="false" aria-controls="collapseOne{{ pedido.id }}">
                              Pedido R$ {{ pedido.valor|floatformat:2 }} ({{ pedido.qtdParcelas }} parcelas)<br>

                            </button>
                          </h5>
                        </div>

                        <div id="collapseOne{{ pedido.id }}" class="collapse" aria-labelledby="headingOne"  data-parent="#accordionParcela{{ pedido.id }}">
                            <div class="card text-white bg-secondary mb-3" >
                                <div class="card-header" style="font-size: small;">
                                {% for parcela in pedido.parcela_set.all  %}
                                    {%  if parcela.numParcela < 10 %}
                                        Parcela 0{{ parcela.numParcela }}:
                                    {%  else %}
                                        Parcela {{ parcela.numParcela }}:
                                    {% endif %}
                                            {{ parcela.dataVencimento|date:'d/m/Y'  }} | R$ {{ parcela.valor|floatformat:2 }}
                                    {%  if parcela.paga %}
                                        <img src="{% static 'images/check.png'%}" alt="Editar" >
                                    {%  else %}
                                        <img src="{% static 'images/not.png'%}" alt="Editar" >
                                        <a href="{% url 'update_parcela' parcela.id %}"> <img src="{% static 'images/edit.png'%}" alt="Editar" width="7%"></a>
                                    {%  endif%}

                                    <br>
                                 {%  endfor  %}
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                    <!-- fim accordion -->

                    <!-- Accordion -->
                    <div id="accordionComissao{{ pedido.id }}">
                      <div class="card">
                        <div class="card-header" id="headingOne">
                          <h5 class="mb-0">
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOneComissao{{ pedido.id }}" aria-expanded="false" aria-controls="collapseOneComissao{{ pedido.id }}">
                              Comissão R$ {{ pedido.total_comissao|floatformat:2 }} ({{ pedido.vendedor.duracao_em_meses }} parcelas)<br>

                            </button>
                          </h5>
                        </div>

                        <div id="collapseOneComissao{{ pedido.id }}" class="collapse" aria-labelledby="headingOne"  data-parent="#accordionComissao{{ pedido.id }}">
                            <div class="card text-white bg-secondary mb-3" >
                                <div class="card-header" style="font-size: small;">
                                {% for comissao in pedido.comissao_set.all  %}
                                    {%  if comissao.numParcelaComissao < 10 %}
                                        Mês 0{{ comissao.numParcelaComissao }}:
                                    {%  else %}
                                        Mês {{ comissao.numParcelaComissao }}:
                                    {% endif %}
                                            {{ comissao.dataVencimento|date:'d/m/Y'  }} | R$ {{ comissao.valor|floatformat:2 }}
                                    {%  if comissao.paga %}
                                        <img src="{% static 'images/check.png'%}" alt="Editar" >
                                    {%  else %}
                                        <img src="{% static 'images/not.png'%}" alt="Editar" >
                                        <a href="{% url 'update_comissao' comissao.id %}"> <img src="{% static 'images/edit.png'%}" alt="Editar" width="7%"></a>
                                    {%  endif%}

                                    <br>
                                 {%  endfor  %}
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                    <!-- fim accordion -->
                </div>
                <div class="card-footer bg-transparent" align="center">
                    <a href="{% url 'update_pedido' pedido.id %}" ><img src="{% static 'images/edit.png'%}" alt="Editar" ></a>&nbsp;
                    <a href="{% url 'create_andamento' pedido.id 'pedido' %}"><img src="{% static 'images/ship.png'%}" alt="Movimentar" ></a>&nbsp;
                    <a href="{% url 'delete_pedido' pedido.id %}"><img src="{% static 'images/delete.png'%}" alt="Deletar" ></a>&nbsp;
                </div>
            </div>
        </div>
        {% endfor %}
    </div><br>


{% endblock %}
